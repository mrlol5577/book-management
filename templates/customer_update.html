{% extends 'base.html' %}

{% block title %}
обнова стати
{% endblock %}

{% block body %}
<h1>Редагування покупця</h1>

<form method="post" class="from-control">
        <input type="text" name="buyer" class="text_customer" value="{{book.buyer}}" placeholder="Введіть Ім'я покупця" id="buyerInput"><br>
        <input type="text" name="phone" class="text_customer" value="{{book.phone}}" placeholder="Введіть номер телефону покупця" id="phoneInput"><br>
        
        <label for="enddate">Дата закінчення минулого читача:</label>
        <input type="date" name="enddate" class="date" id="enddateInput" required><br>
        
        <button id="da" class="btn btn-success" type="submit">Оновити</button>
        <select class="state" type="title" name="stat" id="buyerSelect"> 
                <option value="є" {% if book.stat == 'є' %}selected{% endif %}>читача є</option>
                <option value="нема" {% if book.stat == 'нема' %}selected{% endif %}>читача нема</option>
        </select>
</form>

{% if book.history %}
<div class="history-section" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
        <h3>Історія бронювань:</h3>
        <p>{{ book.history }}</p>
</div>
{% endif %}

<script>
        const buyerSelect = document.getElementById('buyerSelect');
        const phoneInput = document.getElementById('phoneInput');
        const buyerInput = document.getElementById('buyerInput');
        const enddateInput = document.getElementById('enddateInput');
        const form = document.querySelector('form');

        // Встановлюємо поточну дату за замовчуванням
        const today = new Date().toISOString().split('T')[0];
        enddateInput.value = today;

        function updateFields() {
                if (buyerSelect.value === 'нема') {
                        phoneInput.classList.add('hidden');
                        buyerInput.classList.add('hidden');
                } else {
                        phoneInput.classList.remove('hidden');
                        buyerInput.classList.remove('hidden');
                }
        }

        // Перехоплюємо відправку форми
        form.addEventListener('submit', function(e) {
                if (buyerSelect.value === 'нема') {
                        // Очищаємо значення полів перед відправкою
                        buyerInput.value = '';
                        phoneInput.value = '';
                }
        });

        updateFields();
        buyerSelect.addEventListener('change', updateFields);
</script>
{% endblock %}